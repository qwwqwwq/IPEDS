<!DOCTYPE html>
<meta charset="utf-8">
<style>

body {
  position: relative;
}

.key {
  font: 10px sans-serif;
  position: absolute;
  top: 0;
  left: 0;
}

.caption {
  font-weight: bold;
}

.key path {
  display: none;
}

.key line {
  stroke: #000;
  shape-rendering: crispEdges;
}

.border {
    fill: none;
    stroke: #fff;
    stroke-linecap: round;
    stroke-linejoin: round;
}

</style>
<body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.19/topojson.js"></script>
<script>

var width = 960,
    height = 600;

var color = d3.scale.linear()
        .domain([0, 20, 40])
        .range(["#edf8b1","#7fcdbb","#2c7fb8"]);

var x = d3.scale.linear()
    .domain([0, 35])
    .range([0, 200]);

var xAxis = d3.svg.axis()
    .scale(x)
    .orient("bottom")
    .tickSize(13)
    .tickFormat(d3.format(".0f"));

var canvas = d3.select("body").append("canvas")
    .attr("width", width)
    .attr("height", height);

var context = canvas.node().getContext("2d");

var path = d3.geo.path()
    .projection(null)
    .context(context);

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height)
    .attr("class", "key")
  .append("g")
    .attr("transform", "translate(60," + (height - 60) + ")");

var borders_svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height)
        .append("g");

svg.selectAll("rect")
    .data(pair(x.ticks(10)))
      .enter().append("rect")
    .attr("height", 8)
    .attr("x", function(d) { return x(d[0]); })
    .attr("width", function(d) { return x(d[1]) - x(d[0]); })
    .style("fill", function(d) { return color(d[0]); });

svg.call(xAxis).append("text")
    .attr("class", "caption")
    .attr("y", -6)
    .text("Elevation");

d3.json("../gis/lower_48_contour.topojson", function(error, ophz) {
  if (error) throw error;

  topojson.feature(ophz, ophz.objects.levels)
      .features
      .sort(function(a, b) { return a.elevation - b.elevation; })
      .forEach(render);

    borders_svg.append("path")
        .datum(topojson.mesh(ophz, ophz.objects.us_lower_48_states, function(a, b) { return a !== b }))
        .attr("class", "border")
        .attr("d", path);


});

function pair(array) {
  return array.slice(1).map(function(b, i) {
    return [array[i], b];
  });
}

function render(d) {
  var elev = d.properties.elevation;
  context.fillStyle = color(elev);
  context.beginPath();
  path(d);
  context.fill();
}

</script>

